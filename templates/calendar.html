{% extends 'base.html' %}
{% block content %}

<div id='calendar'></div>
<div id='meal_info'></div>

<script>

    function setCalendarContent() {
        //initialize a empty list of events because fullcalendar understands lists
        let events = [];
        //loop through the meals to obtain each meal
        {% for meal in meals_for_user %}
            //initialize an empty event object to store each meal data
            event = {};
            event.title='{{ meal.meal_name }}';

            event.start_utc=moment.utc('{{ meal.meal_time }}');
            event.start=moment(event.start_utc).local().format("YYYY-MM-DD HH:mm:ss");
            //initialize an empty meal foodgroup list for each meal food info
            event.meal_foodgroups=[];

            //loop through each of the mral_foodgroups in each meal
            {% for m in meal.meal_foodgroups %}
                //add to the empty meal_foodgroups list each component in a particular format as defined in model.py
                event.meal_foodgroups.push({{ m.serialize()|tojson }});
                // {{ m }}

            {% endfor %}

            event.allDay=false
            //add to the events list each event
            events.push(event)

        {% endfor %}
        //from fullcalendar, to initialize calendar
        $('#calendar').fullCalendar({
            //passing in events
            events: events,
            // eventRender: function(eventObj, $el) {
    //   $el.popover({
    //     title: eventObj.title,
    //     content: eventObj.description,
    //     trigger: 'hover',
    //     placement: 'top',
    //     container: 'body'
    //   });
    // },
            eventClick: function(calEvent, jsEvent, view) {
                $("#meal_info").text('');
                for (m in calEvent.meal_foodgroups) {
                    //document.write(m);
                    $("#meal_info").append(JSON.stringify(calEvent.meal_foodgroups[m]));
                }
            },
        })
    }
    $(setCalendarContent);
</script>



{% endblock %}